const { EmbedBuilder } = require('discord.js')

const movieSearchCommand = async (interaction) => {
  await interaction.deferReply()
  const query = interaction.options.get('title').value
  if (!query) {
    await interaction.reply('Please provide a movie title to search for.')
    return
  }

  try {
    const response = await fetch(`https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(query)}`, {
      headers: {
        'Authorization': `Bearer ${process.env.TMDB_API_KEY}`,
      }
    })
    const data = await response.json()
    const movie = data.results[0]

    if (movie) {
      const embed = new EmbedBuilder()
        .setColor('#009dff')
        .setTitle(`${movie.title} (${movie.release_date?.split('-')[0] || 'N/A'})`)
        .setDescription(movie.overview || 'No overview available.')
        .setThumbnail(`https://image.tmdb.org/t/p/w500${movie.poster_path}`)
        .addFields(
          {
            name: 'Release Date',
            value: movie.release_date || 'Unknown',
            inline: true
          }
        )
        .setFooter({ text: `TMDB ID: ${movie.id}` })

        console.log(`Found movie: ${movie.title} (${movie.id})`)
        await interaction.editReply({ embeds: [embed] })
      } else {
        await interaction.editReply({ content: 'No movie found with that title.', ephemeral: true })
      }
  } catch (error) {
    console.error('Error fetching movie data:', error)
  }
}

module.exports = { movieSearchCommand }